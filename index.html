<html>
    <head>
        <title>Seam Carving: Javascript Canvas</title>
        <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.6/themes/base/jquery-ui.css" type="text/css" media="all" />
        <link rel="stylesheet" href="http://static.jquery.com/ui/css/demo-docs-theme/ui.theme.css" type="text/css" media="all" />
    </head>
    <style>
        
        body {
            font-family: Arial, Helvetica, sans-serif;
            font-size: 14px;
            padding: 0;
            margin: auto;
            width: 90%;
            background-color: WHITE;
        }
        
        #resizer {
            border: SOLID 2px RED;
            border-right: DOTTED 5px ORANGE;
            text-align: left;
            position: absolute;
            padding: 0;
            margin: 0;
        }
        
        #source img {
            float: left;
            padding: 1em;
            height: 200px;
            cursor: pointer;
        }
        
        #canvas {
            border: SOLID 1px GRAY;
        }
        
        #source img:hover {
        }
    </style>
    <body>
        <h1 style ="text-align:center">Seam Carving using Javascript</h1>
        <img id = "source" src = "ball.jpg"/>
        <div style ="clear:both;border-bottom : BLACK 3px DOTTED; margin : 10px; height : 1px; width : 100%;">
        </div>
        <canvas id = "canvas">
        </canvas>
        <div id = "resizer" style ="overflow:hidden">
        </div>
        <marquee>
            This UI element keeps moving. If this stops, your UI is frozen
        </marquee>
    </body>
    <script src = "https://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js" type = "text/javascript">
    </script>
    <script src = "https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.6/jquery-ui.min.js" type = "text/javascript">
    </script>
    <script src = "seamJSON.js" type = "text/javascript">
    </script>
    <script src = "SeamCarver.js" type = "text/javascript">
    </script>
    <script type="text/javascript">
        (function(){
            var canvas = document.getElementById("canvas");
            try {
                var ctx = canvas.getContext("2d");
            } 
            catch (e) {
                alert("Your browser does not support the canvas element");
                return;
            }
            
            var img = new Image();
            var imageData = null;
            img.src = $("#source").attr("src");
            img.onload = function(){
                canvas.height = img.height;
                canvas.width = img.width;
                ctx.drawImage(img, 0, 0);
                $("#resizer").css({
                    "top": $("#canvas").position().top,
                    "height": img.height,
                    "width": img.width
                });
                imageData = ctx.getImageData(0, 0, img.width, img.height);
                
                var worker = new Worker("SeamCarver.js");
                worker.addEventListener("message", function(e){
                    newImage = ctx.createImageData(e.data.width, e.data.height);
                    for (var i = 0; i < e.data.data.length; i++) {
                        newImage.data[i] = e.data.data[i];
                    }
                    ctx.putImageData(newImage, 0, 0);
                }, false);
                
                $("#resizer").resizable({
                    "stop": function(){
                        /*SeamCarver({
                            "width": imageData.width,
                            "height": imageData.height,
                            "data": imageData.data
                        }, {
                            "height": $("#resizer").height(),
                            "width": $("#resizer").width()
                        }, function(data){
                            newImage = ctx.createImageData(data.width, data.height);
                            for (var i = 0; i < data.data.length; i++) {
                                newImage.data[i] = data.data[i];
                            }
                            ctx.putImageData(newImage, 0, 0);
                        });*/
                        worker.postMessage({
                         "image": {
                         "width": imageData.width,
                         "height": imageData.height,
                         "data": imageData.data
                         },
                         "adjust": {
                         "height": $("#resizer").height(),
                         "width": $("#resizer").width()
                         }
                         });
                    },
                    "minHeight": imageData.height,
                    "maxHeight": imageData.height,
                    "minWidth": 100,
                    "maxWidth": imageData.width
                });
            }
        })();
    </script>
</html>
