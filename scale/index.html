<html>
    <head>
        <title>Pixel Art Scaling</title>
    </head>
    <body>
        <h1 style ="text-align:center"><a href = "http://en.wikipedia.org/wiki/Pixel_art_scaling_algorithms" target = "_blank">Pixel Art Scaling</a> using <a href = "http://en.wikipedia.org/wiki/Canvas_element" target = "_blank">Canvas</a> and <a href = "http://www.whatwg.org/specs/web-workers/current-work/" target = "_blank">Web Workers</a></h1>
        <img src = "res/pixel1.png" id = "source"/>
        <canvas id = "canvas">
        </canvas>
        <script type = "text/javascript">
            (function(){
                var canvas = document.getElementById("canvas");
                try {
                    var ctx = canvas.getContext("2d");
                } 
                catch (e) {
                    alert("Your browser does not support the canvas element");
                    return;
                }
                
                var worker = new Worker("Scaler.js");
                worker.addEventListener("message", function(e){
                    switch (e.data.action) {
                        case "log":
                            console.log(e.data.msg);
                            break;
                        case "done":
                            var newImage = ctx.createImageData(e.data.image.width, e.data.image.height);
                            for (var i = 0; i < e.data.image.data.length; i++) {
                                newImage.data[i] = e.data.image.data[i];
                            }
                            ctx.putImageData(newImage, 0, 0);
                            break;
                    }
                }, false);
                
                var img = document.getElementById("source");
                canvas.height = img.height;
                canvas.width = img.width;
                ctx.drawImage(img, 0, 0);
                var imageData = ctx.getImageData(0, 0, img.width, img.height);
                
                worker.postMessage({
                    "image": {
                        "width": imageData.width,
                        "height": imageData.height,
                        "data": imageData.data
                    }
                });
            })();
        </script>
    </body>
</html>
